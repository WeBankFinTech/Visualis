(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"162badf8105dc7af2987":function(e,t,n){"use strict";n("430efd9ee93fab5ea3aa");var r=n("ab77426700a64afb515f"),a=n.n(r),i=(n("cce4e96b47a88eedc219"),n("4634762afad890a7174e")),o=n.n(i),c=n("8af190b70a6bc55c6f1b"),s=n.n(c),l=n("0d7f0986bcd2f33d8a2a"),u=n.n(l),d=n("d7dd51e1bf6bfc2c9c3d"),f=n("a28fc3c963a1d4d1a2e5"),b=n("ab4cb61bcb2dc161defb"),p=n("811a4999285c4f950f0a"),g=n("fe25efaa8d6f45e3f5f9"),y=n("54f683fcda7806277002"),m="davinci/Share/LOAD_SHARE_DASHBOARD",h="davinci/Share/LOAD_SHARE_DASHBOARD_SUCCESS",v="davinci/Share/LOAD_SHARE_DASHBOARD_FAILURE",O="davinci/Share/SET_INDIVIDUAL_DASHBOARD",S="davinci/Share/LOAD_SHARE_WIDGET",I="davinci/Share/LOAD_SHARE_WIDGET_SUCCESS",w="davinci/Share/LOAD_SHARE_RESULTSET",j="davinci/Share/LOAD_SHARE_RESULTSET_SUCCESS",A="davinci/Share/LOAD_WIDGET_CSV",L="davinci/Share/LOAD_WIDGET_CSV_SUCCESS",D="davinci/Share/LOAD_WIDGET_CSV_FAILURE",_="davinci/Share/LOAD_SELECT_OPTIONS",k="davinci/Share/LOAD_SELECT_OPTIONS_SUCCESS",E="davinci/Share/LOAD_SELECT_OPTIONS_FAILURE",C="davinci/Share/RESIZE_ALL_DASHBOARDITEM",R="davinci/Dashboard/DRILL_DASHBOARDITEM",T="davinci/Dashboard/DELETE_DRILL_HISTORY",F="davinci/Dashboard/SET_SELECT_OPTIONS";function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var q=Object(y.fromJS)({dashboard:null,title:"",config:"{}",dashboardSelectOptions:null,widgets:null,items:null,itemsInfo:null});var H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload,a=e.get("dashboardSelectOptions"),i=e.get("itemsInfo"),o=e.get("widgets");switch(n){case h:return e.set("title",r.dashboard.name).set("dashboard",r.dashboard).set("config",r.dashboard.config).set("dashboardSelectOptions",{}).set("widgets",r.dashboard.widgets).set("items",r.dashboard.relations).set("itemsInfo",r.dashboard.relations.reduce(function(e,t){return e[t.id]={datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[],pagination:{}},downloadCsvLoading:!1,interactId:"",renderType:"rerender",controlSelectOptions:{}},e},{}));case O:return e.set("items",[{id:1,x:0,y:0,width:12,height:12,polling:!1,frequency:0,widgetId:r.widgetId,dataToken:r.token}]).set("itemsInfo",{1:{datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[],pagination:{}},downloadCsvLoading:!1,interactId:"",renderType:"rerender",controlSelectOptions:{}}});case I:return o||(o=[]),e.set("widgets",o.concat(r.widget));case w:return e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{loading:!0,queryConditions:Object.assign({},i[r.itemId].queryConditions,{tempFilters:r.requestParams.tempFilters,linkageFilters:r.requestParams.linkageFilters,globalFilters:r.requestParams.globalFilters,variables:r.requestParams.variables,linkageVariables:r.requestParams.linkageVariables,globalVariables:r.requestParams.globalVariables,pagination:r.requestParams.pagination,nativeQuery:r.requestParams.nativeQuery})}))));case R:return i[r.itemId].queryConditions.drillHistory||(i[r.itemId].queryConditions.drillHistory=[]),e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{queryConditions:Object.assign({},i[r.itemId].queryConditions,{drillHistory:i[r.itemId].queryConditions.drillHistory.concat(r.drillHistory)})}))));case T:return e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{queryConditions:Object.assign({},i[r.itemId].queryConditions,{drillHistory:i[r.itemId].queryConditions.drillHistory.slice(0,r.index+1)})}))));case j:return e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{loading:!1,datasource:r.resultset||{resultList:[]},renderType:r.renderType}))));case A:return e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{downloadCsvLoading:!0}))));case L:case D:return e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{downloadCsvLoading:!1}))));case k:return r.itemId?e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{controlSelectOptions:Object.assign({},i[r.itemId].controlSelectOptions,P({},r.controlKey,r.values))})))):e.set("dashboardSelectOptions",Object.assign({},a,P({},r.controlKey,r.values)));case F:return r.itemId?e.set("itemsInfo",Object.assign({},i,P({},r.itemId,Object.assign({},i[r.itemId],{controlSelectOptions:Object.assign({},i[r.itemId].controlSelectOptions,P({},r.controlKey,r.options))})))):e.set("dashboardSelectOptions",Object.assign({},a,P({},r.controlKey,r.options)));case C:return e.set("itemsInfo",Object.entries(i).reduce(function(e,t){var n=x(t,2),r=n[0],a=n[1];return e[r]=Object.assign({},a,{renderType:"resize",datasource:Object.assign({},a.datasource)}),e},{}));default:return e}},V=n("74431d47afb6248fcb69"),U=n("6c68d13fe9e3e77d8fc4");function N(e){return{type:h,payload:{dashboard:e}}}function Y(e){return{type:I,payload:{widget:e}}}function W(e,t,n,r){return{type:j,payload:{renderType:e,itemId:t,requestParams:n,resultset:r}}}function z(e){return{type:L,payload:{itemId:e}}}function G(e){return{type:D,payload:{itemId:e}}}function J(e,t,n){return{type:k,payload:{controlKey:e,values:t,itemId:n}}}var B=n("95066b9b78a83cfbe91a"),M=n("55c69f0ea731e712b8f3"),K=n("9adba983ceae6f089ff0"),$=n("eb331aa378875c02c40d");function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Z=regeneratorRuntime.mark(ie),X=regeneratorRuntime.mark(oe),ee=regeneratorRuntime.mark(ce),te=regeneratorRuntime.mark(se),ne=regeneratorRuntime.mark(le),re=regeneratorRuntime.mark(ue),ae=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&(n[r[a]]=e[r[a]])}return n};$.a[$.b].shareHost;function ie(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,r.prev=1,r.next=4,Object(U.b)(B.a,"".concat(K.a.share,"/dashboard/").concat(t.token));case 4:return n=r.sent,r.next=7,Object(U.c)(N(n.payload));case 7:r.next=14;break;case 9:return r.prev=9,r.t0=r.catch(1),r.next=13,Object(U.c)({type:v});case 13:t.reject(r.t0);case 14:case"end":return r.stop()}},Z,this,[[1,9]])}function oe(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,r.prev=1,r.next=4,Object(U.b)(B.a,"".concat(K.a.share,"/widget/").concat(t.token));case 4:return n=r.sent,r.next=7,Object(U.c)(Y(n.payload));case 7:t.resolve&&t.resolve(n.payload),r.next=14;break;case 10:r.prev=10,r.t0=r.catch(1),Object(M.a)(r.t0),t.reject(r.t0);case 14:case"end":return r.stop()}},X,this,[[1,10]])}function ce(e){var t,n,r,a,i,o,c,s,l,u,d,f,b,p,g,y,m,h,v;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return t=e.payload,n=t.renderType,r=t.itemId,a=t.dataToken,i=t.requestParams,o=i.filters,c=i.tempFilters,s=i.linkageFilters,l=i.globalFilters,u=i.variables,d=i.linkageVariables,f=i.globalVariables,b=i.pagination,p=ae(i,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables","pagination"]),y=(g=b||{pageSize:0,pageNo:0}).pageSize,m=g.pageNo,O.prev=4,O.next=7,Object(U.b)(B.a,{method:"post",url:"".concat(K.a.share,"/data/").concat(a),data:Object.assign({},p,{filters:o.concat(c).concat(s).concat(l),params:u.concat(d).concat(f),pageSize:y,pageNo:m})});case 7:return h=O.sent,v=h.payload.resultList,h.payload.resultList=v&&v.slice(0,500)||[],O.next=12,Object(U.c)(W(n,r,i,h.payload));case 12:O.next=17;break;case 14:O.prev=14,O.t0=O.catch(4),Object(M.a)(O.t0);case 17:case"end":return O.stop()}},ee,this,[[4,14]])}function se(e){var t,n,r,a,i,o,c,s,l,u,d,f,b;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return t=e.payload,n=t.itemId,r=t.requestParams,a=t.token,i=r.filters,o=r.tempFilters,c=r.linkageFilters,s=r.globalFilters,l=r.variables,u=r.linkageVariables,d=r.globalVariables,f=ae(r,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables"]),p.prev=2,p.next=5,Object(U.b)(B.a,{method:"post",url:"".concat(K.a.share,"/csv/").concat(a),data:Object.assign({},f,{filters:i.concat(o).concat(c).concat(s),params:l.concat(u).concat(d)})});case 5:return b=p.sent,p.next=8,Object(U.c)(z(n));case 8:location.href=b.payload,p.next=16;break;case 11:return p.prev=11,p.t0=p.catch(2),p.next=15,Object(U.c)(G(n));case 15:Object(M.a)(p.t0);case 16:case"end":return p.stop()}},te,this,[[2,11]])}function le(e){var t,n,r,a,i,o,c,s,l;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,t=e.payload,n=t.controlKey,r=t.dataToken,a=t.requestParams,i=t.itemId,o=Object.entries(a),c=o.map(function(e){var t=Q(e,2),n=t[0],a=t[1],i=a.columns,o=a.filters,c=a.variables;return Object(U.b)(B.a,{method:"post",url:"".concat(K.a.share,"/data/").concat(r,"/distinctvalue/").concat(n),data:{columns:i,filters:o,params:c}})}),u.next=7,Object(U.a)(c);case 7:return s=u.sent,l=s.reduce(function(e,t,n){var r=o[n][1].columns;return 1===r.length?e.concat(t.payload.map(function(e){return e[r[0]]})):e},[]),u.next=11,Object(U.c)(J(n,l,i));case 11:u.next=18;break;case 13:return u.prev=13,u.t0=u.catch(0),u.next=17,Object(U.c)((d=u.t0,{type:E,payload:{error:d}}));case 17:Object(M.a)(u.t0);case 18:case"end":return u.stop()}var d},ne,this,[[0,13]])}function ue(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(V.c)(m,ie),Object(V.b)(S,oe),Object(V.b)(w,ce),Object(V.c)(A,se),Object(V.b)(_,le)];case 2:case"end":return e.stop()}},re,this)}var de,fe=n("6c1890243ba884c62600"),be=n("38669f46145e5bedaa8f"),pe=n("cd16e7d68404f3230c38"),ge=n("86d17dd26e83afa66ef9"),ye=n("d13558d97f410e04ee44"),me=n("30cc03302807d9f9cf5a"),he=function(e){return e.get("shareDashboard")},ve=n("e54a068d600ce8162b8c"),Oe=n("545cc1d5b2c0ab4381ef"),Se=(n("c099c4fc48cd9bb84110"),n("21700e306353b2e19c0b")),Ie=n.n(Se),we=n("faa1775c23cdc998dbb4"),je=n("6b84bc0ba52f69619b39");function Ae(e){return(Ae="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e,t,n,r){de||(de="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),t&&a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);else t||(t=a||{});if(1===i)t.children=r;else if(i>1){for(var c=new Array(i),s=0;s<i;s++)c[s]=arguments[s+3];t.children=c}return{$$typeof:de,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,t){return!t||"object"!==Ae(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ke(e){return(ke=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Ce=n("f3ae47cf584ff0a4203b"),Re=n("788b454b5eadc7b7f231"),Te=Le(u.a,{title:"Login"}),Fe=Le(Ie.a,{type:"loading"}),xe=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=_e(this,ke(t).call(this,e))).changeUsername=function(e){n.setState({username:e.target.value.trim()})},n.changePassword=function(e){n.setState({password:e.target.value})},n.doLogin=function(){var e=n.props,t=e.onLogin,r=e.shareInfo,a=e.legitimateUser,i=n.state,o=i.username,c=i.password;o&&c&&t(o,c,r,function(){a()})},n.state={username:"",password:""},n}var r,a,i;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,c["PureComponent"]),r=t,(a=[{key:"render",value:function(){var e=this.props.loginLoading,t=this.state,r=t.username,a=t.password;return Le("div",{className:"".concat(Ce.container," ").concat(Ce.share)},void 0,Te,Le("img",{className:Ce.logo,src:n("43a863c5e801a2996d08")}),Le("div",{className:"".concat(Ce.window," ").concat(Re.window)},void 0,Le(we.a,{username:r,password:a,onChangeUsername:this.changeUsername,onChangePassword:this.changePassword,onLogin:this.doLogin}),Le("button",{disabled:e,onClick:this.doLogin},void 0,e?Fe:"","\u767b \u5f55")))}}])&&De(r.prototype,a),i&&De(r,i),t}();var Pe,qe=Object(d.connect)(null,function(e){return{onLogin:function(t,n,r,a){return e(Object(je.b)(t,n,r,a))}}})(xe);function He(e){return(He="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ve(e,t,n,r){Pe||(Pe="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),t&&a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);else t||(t=a||{});if(1===i)t.children=r;else if(i>1){for(var c=new Array(i),s=0;s<i;s++)c[s]=arguments[s+3];t.children=c}return{$$typeof:Pe,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function Ue(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ye(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function We(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ze(e,t){return!t||"object"!==He(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t){return(Je=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Be=n("c7b06d3320a5509f12ff"),Me=Object(ye.b)(ye.a),Ke=Ve("h3",{},void 0,"\u6570\u636e\u52a0\u8f7d\u4e2d\u2026\u2026"),$e=Ve("div",{id:"phantomRenderSign"}),Qe=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=ze(this,Ge(t).call(this,e))).interactCallbacks={},n.interactingLinkagers={},n.interactGlobalFilters={},n.resizeSign=0,n.loadShareContent=function(e){var t=n.props,r=t.onLoadDashboard,a=t.onLoadWidget,i=t.onSetIndividualDashboard;"dashboard"===e.type?r(e.shareInfo,function(e){403===e.response.status&&n.setState({showLogin:!0})}):a(e.shareInfo,function(t){i(t.id,e.shareInfo)},function(e){403===e.response.status&&n.setState({showLogin:!0})})},n.getQs=function(e){return e.split("&").reduce(function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{})},n.getChartData=function(e,t,r,a){n.getData(n.props.onLoadResultset,e,t,r,a)},n.downloadCsv=function(e,t,r){n.getData(function(e,t,r,a){n.props.onLoadWidgetCsv(t,a,r)},"rerender",e,t)},n.getData=function(e,t,r,a,i){var o,c,s,l,u,d,f,b,p,g=n.props,y=g.currentItemsInfo,m=g.widgets.find(function(e){return e.id===a}),h=JSON.parse(m.config),v=h.cols,O=h.rows,S=h.metrics,I=h.secondaryMetrics,w=h.filters,j=h.color,A=h.label,L=h.size,D=h.xAxis,_=h.tip,k=h.orders,E=h.cache,C=h.expired,R=y[r].queryConditions;i?(o=void 0!==i.tempFilters?i.tempFilters:R.tempFilters,c=void 0!==i.linkageFilters?i.linkageFilters:R.linkageFilters,s=void 0!==i.globalFilters?i.globalFilters:R.globalFilters,l=i.variables||R.variables,u=i.linkageVariables||R.linkageVariables,d=i.globalVariables||R.globalVariables,f=i.drillStatus||void 0,b=i.pagination||R.pagination,p=i.nativeQuery||R.nativeQuery):(o=R.tempFilters,c=R.linkageFilters,s=R.globalFilters,l=R.variables,u=R.linkageVariables,d=R.globalVariables,b=R.pagination,p=R.nativeQuery);var T=v.concat(O).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),F=S.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}});I&&I.length&&(F=F.concat(I.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),j&&(T=T.concat(j.items.map(function(e){return e.name}))),A&&(T=T.concat(A.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),F=F.concat(A.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),L&&(F=F.concat(L.items.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),D&&(F=F.concat(D.items.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),_&&(F=F.concat(_.items.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),e(t,r,m.dataToken,{groups:f&&f.groups?f.groups:T,aggregators:F,filters:f&&f.filter?f.filter.sqls:w.map(function(e){return e.config.sql}),tempFilters:o,linkageFilters:c,globalFilters:s,variables:l,linkageVariables:u,globalVariables:d,orders:k,cache:E,expired:C,pagination:b,nativeQuery:p})},n.onWindowResize=function(){n.resizeSign&&clearTimeout(n.resizeSign),n.resizeSign=window.setTimeout(function(){n.props.onResizeAllDashboardItem(),clearTimeout(n.resizeSign),n.resizeSign=0},500)},n.visibleFullScreen=function(e){var t=n.state.allowFullScreen;e&&n.setState({currentDataInFullScreen:e}),n.setState({allowFullScreen:!t})},n.currentWidgetInFullScreen=function(e){var t=n.props,r=t.currentItems,a=t.currentItemsInfo,i=t.widgets,o=r.find(function(t){return t.id===e}),c=i.find(function(e){return e.id===o.widgetId}),s=a[e],l=a.loading;n.setState({currentDataInFullScreen:{itemId:e,widgetId:c.id,widget:c,data:s,loading:l,onGetChartData:n.getChartData}})},n.handleLegitimateUser=function(){var e=n.state,t=e.type,r=e.shareInfo;n.setState({showLogin:!1},function(){n.loadShareContent({type:t,shareInfo:r})})},n.checkInteract=function(e){return n.props.linkages.some(function(t){return+t.trigger[0]===e})},n.doInteract=function(e,t){var r=n.props,a=r.currentItems,i=r.linkages,o=Object(be.a)(e,i);n.interactingLinkagers=Object(be.b)(e,t,o,n.interactingLinkagers),Object.keys(o).forEach(function(e){var t=a.find(function(t){return t.id===+e}),r=n.interactingLinkagers[e],i=r.filters,o=r.variables;n.getChartData("rerender",+e,t.widgetId,{linkageFilters:Object.values(i).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[]),linkageVariables:Object.values(o).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[])})}),n.setState({interactingStatus:Object.assign({},n.state.interactingStatus,Ne({},e,!0))})},n.turnOffInteract=function(e){var t=n.props,r=t.linkages,a=t.currentItems;Object(be.c)(e,r,n.interactingLinkagers).forEach(function(e){var t=a.find(function(t){return t.id===e}),r=n.interactingLinkagers[e],i=r.filters,o=r.variables;n.getChartData("rerender",e,t.widgetId,{linkageFilters:Object.values(i).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[]),linkageVariables:Object.values(o).reduce(function(e,t){return e.concat.apply(e,Ye(t))},[])})}),n.setState({interactingStatus:Object.assign({},n.state.interactingStatus,Ne({},e,!1))})},n.getOptions=function(e,t,r,a){t?n.props.onSetSelectOptions(e,r,a):n.props.onLoadSelectOptions(e,n.state.shareInfo,r,a)},n.globalFilterChange=function(e){var t=n.props,r=t.currentItems,a=t.currentItemsInfo;Object.entries(e).forEach(function(e){var t=Ue(e,2),i=t[0],o=t[1],c=r.find(function(e){return e.id===+i});if(c){var s=0,l=a[i].queryConditions.pagination;l.pageNo&&(s=1);var u=o.variables,d=o.filters;n.getChartData("rerender",+i,c.widgetId,{globalVariables:u,globalFilters:d,pagination:Object.assign({},l,{pageNo:s})})}})},n.dataDrill=function(e){var t=n.props,r=t.widgets,a=t.currentItemsInfo,i=t.onDrillDashboardItem,o=e.itemId,c=e.groups,s=e.widgetId,l=e.sourceDataFilter,u=r.find(function(e){return e.id===s}),d=JSON.parse(u.config),f=d.cols,b=d.rows,p=d.metrics,g=(d.filters,d.color),y=d.label,m=(d.size,d.xAxis,d.tip,d.orders,d.cache,d.expired,a[o].queryConditions.drillHistory),h=void 0,v=void 0,O=void 0,S=f.concat(b).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),I=p.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}});g&&(S=S.concat(g.items.map(function(e){return e.name}))),y&&(S=S.concat(y.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),I=I.concat(y.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}})));var w=void 0;if(m&&0!==m.length){var j=m[m.length-1];v=j.groups[j.groups.length-1],O=l.map(function(e){return e[v]}),h="".concat(v," in (").concat(O.map(function(e){return"'".concat(e,"'")}).join(","),")");var A=j.filter.sqls.concat(h),L=j.groups.some(function(e){return e===c});w={filter:{filterSource:O,name:v,sql:h,sqls:A,visualType:"string"},type:L?"up":"down",groups:L?j.groups.filter(function(e){return e!==c}):j.groups.concat([c]),name:c}}else{if(d){if("col"===d.dimetionAxis){var D=d.cols;v=D[D.length-1]}else{var _=d.rows;v=_[_.length-1]}O=l.map(function(e){return e&&e[v]?e[v]:e}),h="".concat(v," in (").concat(O.map(function(e){return"'".concat(e,"'")}).join(","),")")}var k=d.filters.map(function(e){return e.config.sql});k.push(h);var E=S.some(function(e){return e===c});w={filter:{filterSource:O,name:v,sql:h,sqls:k,visualType:"string"},type:E?"up":"down",groups:E?S.filter(function(e){return e!==c}):S.concat([c]),name:c}}i(o,w),n.getChartData("rerender",o,s,{drillStatus:w})},n.selectDrillHistory=function(e,t,r,a){var i=n.props,o=(i.currentItemsInfo,i.onDeleteDrillHistory);e?n.getChartData("rerender",r,a,{drillStatus:e}):(console.log("callback"),n.getChartData("rerender",r,a)),o(r,t)},n.state={type:"",shareInfo:"",modalLoading:!1,interactingStatus:{},allowFullScreen:!1,currentDataInFullScreen:{},showLogin:!1,phantomRenderSign:!1,controlTokenMapping:{}},n}var n,r,i;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Je(e,t)}(t,s.a.Component),n=t,(r=[{key:"componentWillMount",value:function(){var e=this.getQs(location.href.substr(location.href.indexOf("?")+1));this.setState({type:e.type,shareInfo:e.shareInfo}),this.loadShareContent(e)}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize,!1)}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.currentItems,r=e.currentItemsInfo;e.dashboard,e.widgets;r&&Object.values(r).filter(function(e){return!!e.datasource.resultList.length}).length===n.length&&setTimeout(function(){t.setState({phantomRenderSign:!0})},5e3)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize,!1)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.dashboard,i=n.title,c=n.currentItems,s=n.currentItemsInfo,l=n.widgets,d=n.dashboardSelectOptions,f=this.state,b=(f.shareInfo,f.showLogin),p=f.interactingStatus,g=f.allowFullScreen,y=f.phantomRenderSign,m=null,h=null;if(c){var v=[],O={lg:[]};c.forEach(function(e){var n=e.id,r=e.x,a=e.y,i=e.width,o=e.height,c=e.widgetId,u=e.polling,d=e.frequency,f=s[n],b=f.datasource,g=f.loading,y=f.downloadCsvLoading,m=f.renderType,h=f.queryConditions,S=f.controlSelectOptions,I=l.find(function(e){return e.id===c}),w={model:I.model},j=p[n]||!1,A=h.drillHistory;v.push(Ve("div",{},n,Ve(pe.a,{itemId:n,widget:I,widgets:l,view:w,datasource:b,loading:g,polling:u,onDrillData:t.dataDrill,onSelectDrillHistory:t.selectDrillHistory,interacting:j,drillHistory:A,frequency:d,shareInfo:I.dataToken,downloadCsvLoading:y,renderType:m,controlSelectOptions:S,queryConditions:h,onGetChartData:t.getChartData,onDownloadCsv:t.downloadCsv,onTurnOffInteract:t.turnOffInteract,onCheckTableInteract:t.checkInteract,onDoTableInteract:t.doInteract,onShowFullScreen:t.visibleFullScreen,onGetControlOptions:t.getOptions,container:"share"}))),O.lg.push({x:r,y:a,w:i,h:o,i:"".concat(n)})}),m=Ve(Me,{className:"layout",style:{marginTop:"-16px"},rowHeight:Oe.x,margin:[Oe.w,Oe.w],breakpoints:Oe.u,cols:Oe.v,layouts:O,measureBeforeMount:!1,useCSSTransforms:!1,isDraggable:!1,isResizable:!1},void 0,v),h=Ve(ge.a,{widgets:l,currentDashboard:{widgets:c},currentItemsInfo:s,visible:g,isVisible:this.visibleFullScreen,currentDataInFullScreen:this.state.currentDataInFullScreen,onCurrentWidgetInFullScreen:this.currentWidgetInFullScreen})}else m=Ve("div",{className:Be.shareContentEmpty},void 0,Ke),h="";e=b?Ve(qe,{shareInfo:this.state.shareInfo,legitimateUser:this.handleLegitimateUser}):"";var S=y&&$e;return Ve(fe.a,{},void 0,Ve(u.a,{title:i}),Ve(fe.a.Title,{},void 0,Ve(a.a,{},void 0,Ve(o.a,{span:24},void 0,Ve("h2",{className:Be.shareTitle},void 0,i))),Ve(me.a,{currentDashboard:r,currentItems:c,onGetOptions:this.getOptions,mapOptions:d,onChange:this.globalFilterChange})),m,Ve("div",{className:Be.gridBottom}),h,e,S)}}])&&We(n.prototype,r),i&&We(n,i),t}(),Ze=Object(f.b)({dashboard:Object(f.a)(he,function(e){return e.get("dashboard")}),title:Object(f.a)(he,function(e){return e.get("title")}),config:Object(f.a)(he,function(e){return e.get("config")}),widgets:Object(f.a)(he,function(e){return e.get("widgets")}),currentItems:Object(f.a)(he,function(e){return e.get("items")}),currentItemsInfo:Object(f.a)(he,function(e){return e.get("itemsInfo")}),dashboardSelectOptions:Object(f.a)(he,function(e){return e.get("dashboardSelectOptions")}),linkages:Object(f.a)(he,function(e){var t=e.get("config");if(!t)return[];var n=JSON.parse(t||{}).linkages;if(!n)return[];var r=e.get("itemsInfo");return n.filter(function(e){var t=e.linkager,n=e.trigger;return r[t[0]]&&r[n[0]]})})});var Xe,et=Object(d.connect)(Ze,function(e){return{onLoadDashboard:function(t,n){return e(function(e,t){return{type:m,payload:{token:e,reject:t}}}(t,n))},onLoadWidget:function(t,n,r){return e(function(e,t,n){return{type:S,payload:{token:e,resolve:t,reject:n}}}(t,n,r))},onLoadResultset:function(t,n,r,a){return e(function(e,t,n,r){return{type:w,payload:{renderType:e,itemId:t,dataToken:n,requestParams:r}}}(t,n,r,a))},onSetIndividualDashboard:function(t,n){return e(function(e,t){return{type:O,payload:{widgetId:e,token:t}}}(t,n))},onLoadWidgetCsv:function(t,n,r){return e(function(e,t,n){return{type:A,payload:{itemId:e,requestParams:t,token:n}}}(t,n,r))},onLoadSelectOptions:function(t,n,r,a){return e(function(e,t,n,r){return{type:_,payload:{controlKey:e,dataToken:t,requestParams:n,itemId:r}}}(t,n,r,a))},onSetSelectOptions:function(t,n,r){return e(function(e,t,n){return{type:F,payload:{controlKey:e,options:t,itemId:n}}}(t,n,r))},onResizeAllDashboardItem:function(){return e({type:C})},onDrillDashboardItem:function(t,n){return e(function(e,t){return{type:R,payload:{itemId:e,drillHistory:t}}}(t,n))},onDeleteDrillHistory:function(t,n){return e(function(e,t){return{type:T,payload:{itemId:e,index:t}}}(t,n))}}}),tt=Object(p.a)({key:"shareDashboard",reducer:H}),nt=Object(g.a)({key:"shareDashboard",saga:ue}),rt=Object(b.compose)(tt,nt,et)(Qe);!function(e){e.LOAD_SHARE_DISPLAY="davinci/Share/LOAD_SHARE_DISPLAY",e.LOAD_SHARE_DISPLAY_SUCCESS="davinci/Share/LOAD_SHARE_DISPLAY_SUCCESS",e.LOAD_SHARE_DISPLAY_FAILURE="davinci/Share/LOAD_SHARE_DISPLAY_FAILURE",e.LOAD_LAYER_DATA="davinci/Share/LOAD_LAYER_DATA",e.LOAD_LAYER_DATA_SUCCESS="davinci/Share/LOAD_LAYER_DATA_SUCCESS",e.LOAD_LAYER_DATA_FAILURE="davinci/Share/LOAD_LAYER_DATA_FAILURE"}(Xe||(Xe={}));var at=n("af45b63fe9fc857a79a4");function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ot=Object(y.fromJS)({title:"",display:null,slide:null,layers:[],layersInfo:{},widgets:[]});var ct=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ot,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload,a=e.get("layersInfo");switch(n){case Xe.LOAD_SHARE_DISPLAY_SUCCESS:return e.set("title",r.display.name).set("display",r.display).set("slide",r.slide).set("layers",r.slide.relations).set("widgets",r.widgets).set("layersInfo",r.slide.relations.reduce(function(e,t){return e[t.id]=t.type===at.a.Chart?{datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[]},interactId:"",renderType:"rerender"}:{loading:!1},e},{}));case Xe.LOAD_SHARE_DISPLAY_FAILURE:return e.set("display",null).set("slide",null).set("layers",[]).set("widgets",[]).set("layersInfo",{});case Xe.LOAD_LAYER_DATA:return e.set("layersInfo",Object.assign({},a,it({},r.layerId,Object.assign({},a[r.layerId],{loading:!0}))));case Xe.LOAD_LAYER_DATA_SUCCESS:return e.set("layersInfo",Object.assign({},a,it({},r.layerId,Object.assign({},a[r.layerId],{loading:!1,datasource:r.data,renderType:r.renderType}))));case Xe.LOAD_LAYER_DATA_FAILURE:return e.set("loadings",Object.assign({},a,it({},r.layerId,Object.assign({},a[r.layerId],{loading:!1}))));default:return e}},st=(n("aaa12c37f93504858944"),n("21677e23133eca295df8")),lt=n.n(st);function ut(e,t,n){return{type:Xe.LOAD_SHARE_DISPLAY_SUCCESS,payload:{display:e,slide:t,widgets:n}}}function dt(e){return{type:Xe.LOAD_SHARE_DISPLAY_FAILURE,payload:{error:e}}}function ft(e,t,n){return{type:Xe.LOAD_LAYER_DATA_SUCCESS,payload:{renderType:e,layerId:t,data:n}}}var bt=regeneratorRuntime.mark(mt),pt=regeneratorRuntime.mark(ht),gt=regeneratorRuntime.mark(vt),yt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&(n[r[a]]=e[r[a]])}return n};function mt(e){var t,n,r,a,i,o,c,s,l,u;return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return t=e.payload,n=t.token,r=t.resolve,a=t.reject,d.prev=1,d.next=4,Object(U.b)(B.a,"".concat(K.a.share,"/display/").concat(n));case 4:if(i=d.sent,o=i.header,c=i.payload,401!==o.code){d.next=11;break}return a(o.msg),d.next=10,Object(U.c)(dt(o.msg));case 10:return d.abrupt("return");case 11:return l=(s=c).slides,u=s.widgets,d.next=15,Object(U.c)(ut(s,l[0],u));case 15:r(s,l[0],u),d.next=25;break;case 18:return d.prev=18,d.t0=d.catch(1),lt.a.destroy(),d.next=23,Object(U.c)(dt(d.t0));case 23:lt.a.error("\u83b7\u53d6 Display \u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),a(d.t0);case 25:case"end":return d.stop()}},bt,this,[[1,18]])}function ht(e){var t,n,r,a,i,o,c,s,l,u,d,f,b,p,g;return regeneratorRuntime.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return t=e.payload,n=t.renderType,r=t.layerId,a=t.dataToken,i=t.requestParams,o=i.filters,c=i.tempFilters,s=i.linkageFilters,l=i.globalFilters,u=i.variables,d=i.linkageVariables,f=i.globalVariables,b=yt(i,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables"]),y.prev=3,y.next=6,Object(U.b)(B.a,{method:"post",url:"".concat(K.a.share,"/data/").concat(a),data:Object.assign({},b,{filters:o.concat(c).concat(s).concat(l),params:u.concat(d).concat(f)})});case 6:return p=y.sent,g=p.payload.resultList,p.payload.resultList=g&&g.slice(0,500)||[],y.next=11,Object(U.c)(ft(n,r,p.payload));case 11:y.next=17;break;case 13:return y.prev=13,y.t0=y.catch(3),y.next=17,Object(U.c)((m=y.t0,{type:Xe.LOAD_LAYER_DATA_FAILURE,payload:{error:m}}));case 17:case"end":return y.stop()}var m},pt,this,[[3,13]])}function vt(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(V.c)(Xe.LOAD_SHARE_DISPLAY,mt),Object(V.b)(Xe.LOAD_LAYER_DATA,ht)];case 2:case"end":return e.stop()}},gt,this)}var Ot,St=n("f10f809a0f3792f3a22d"),It=function(e){return e.get("shareDisplay")};function wt(e){return(wt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jt(e,t,n,r){Ot||(Ot="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),t&&a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);else t||(t=a||{});if(1===i)t.children=r;else if(i>1){for(var c=new Array(i),s=0;s<i;s++)c[s]=arguments[s+3];t.children=c}return{$$typeof:Ot,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}function At(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dt(e,t){return!t||"object"!==wt(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Et=n("26317c735995b6f84276"),Ct=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Dt(this,_t(t).call(this,e))).charts={},n.getChartData=function(e,t,r,a){var i,o,c,s,l,u,d=n.props,f=d.widgets,b=d.layersInfo,p=d.onLoadLayerData,g=f.find(function(e){return e.id===r}),y=JSON.parse(g.config),m=y.cols,h=y.rows,v=y.metrics,O=y.secondaryMetrics,S=y.filters,I=y.color,w=y.label,j=y.size,A=y.xAxis,L=y.tip,D=y.orders,_=y.cache,k=y.expired,E=b[t].queryConditions;a?(i=void 0!==a.tempFilters?a.tempFilters:E.tempFilters,o=void 0!==a.linkageFilters?a.linkageFilters:E.linkageFilters,c=void 0!==a.globalFilters?a.globalFilters:E.globalFilters,s=a.variables||E.variables,l=a.linkageVariables||E.linkageVariables,u=a.globalVariables||E.globalVariables):(i=E.tempFilters,o=E.linkageFilters,c=E.globalFilters,s=E.variables,l=E.linkageVariables,u=E.globalVariables);var C=m.concat(h).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),R=v.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}});O&&O.length&&(R=R.concat(O.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),I&&(C=C.concat(I.items.map(function(e){return e.name}))),w&&(C=C.concat(w.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),R=R.concat(w.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),j&&(R=R.concat(j.items.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),A&&(R=R.concat(A.items.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),L&&(R=R.concat(L.items.map(function(e){return{column:Object(ve.e)(e.name),func:e.agg}}))),p(e,t,g.dataToken,{groups:C,aggregators:R,filters:S.map(function(e){return e.config.sql}),tempFilters:i,linkageFilters:o,globalFilters:c,variables:s,linkageVariables:l,globalVariables:u,orders:D,cache:_,expired:k})},n.getSlideStyle=function(e){var t,r=n.state.scale,a=e.width,i=e.height,o=e.backgroundColor,c=(e.opacity,e.backgroundImage);if(t={overflow:"visible",width:"".concat(a*r[0],"px"),height:"".concat(i*r[1],"px")},o){var s=o.join();t.backgroundColor="rgb(".concat(s,")")}return c&&(t.backgroundImage='url("'.concat(c,'")')),t},n.loadShareContent=function(){(0,n.props.onLoadDisplay)(n.state.shareInfo,function(){console.log("share page need login...")},function(){n.setState({showLogin:!0})})},n.handleLegitimateUser=function(){n.setState({showLogin:!1},function(){n.loadShareContent()})},n.state={scale:[1,1],showLogin:!1,shareInfo:""},n}var n,r,a;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(t,c["Component"]),n=t,(r=[{key:"componentWillMount",value:function(){var e=this,t=this.props.location.query.shareInfo;this.setState({shareInfo:t},function(){e.loadShareContent()})}},{key:"componentWillReceiveProps",value:function(e){var t=e.slide,n=At(this.state.scale,2),r=n[0],a=n[1];if(t&&this.props.slide!==t){var i=JSON.parse(t.config).slideParams,o=i.scaleMode,c=i.width,s=i.height,l=document.body,u=l.clientHeight,d=l.clientWidth,f=1,b=1;switch(o){case"scaleHeight":b=f=u/s;break;case"scaleWidth":f=b=d/c;break;case"scaleFull":f=u/s,b=d/c}a===f&&r===b||this.setState({scale:[b,f]})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.title,r=t.widgets,a=t.display,i=t.slide,o=t.layers,c=t.layersInfo,s=this.state,l=s.scale,d=s.showLogin,f=s.shareInfo,b=d?jt(qe,{shareInfo:f,legitimateUser:this.handleLegitimateUser}):null,p=null;if(a){var g=this.getSlideStyle(JSON.parse(i.config).slideParams),y=Array.isArray(r)?o.map(function(t){var n=r.find(function(e){return e.id===t.widgetId}),a={model:n&&n.model},i=t.id,o=JSON.parse(t.params),s=o.polling,u=o.frequency,d=c[i],f=d.datasource,b=d.loading,p=d.interactId,g=d.renderType;return jt(St.a,{pure:!0,scale:l,itemId:i,widget:n,view:a,datasource:f,layer:t,loading:b,polling:s,frequency:u,interactId:p,renderType:g,onGetChartData:e.getChartData},t.id)}):null;p=jt("div",{className:Et.board,style:g},void 0,y)}return jt("div",{className:Et.preview},void 0,jt(u.a,{title:n}),p,b)}}])&&Lt(n.prototype,r),a&&Lt(n,a),t}(),Rt=Object(f.b)({title:Object(f.a)(It,function(e){return e.get("title")}),display:Object(f.a)(It,function(e){return e.get("display")}),slide:Object(f.a)(It,function(e){return e.get("slide")}),layers:Object(f.a)(It,function(e){return e.get("layers")}),widgets:Object(f.a)(It,function(e){return e.get("widgets")}),layersInfo:Object(f.a)(It,function(e){return e.get("layersInfo")})});var Tt=Object(d.connect)(Rt,function(e){return{onLoadDisplay:function(t,n,r){return e(function(e,t,n){return{type:Xe.LOAD_SHARE_DISPLAY,payload:{token:e,resolve:t,reject:n}}}(t,n,r))},onLoadLayerData:function(t,n,r,a){return e(function(e,t,n,r){return{type:Xe.LOAD_LAYER_DATA,payload:{renderType:e,layerId:t,dataToken:n,requestParams:r}}}(t,n,r,a))}}}),Ft=Object(p.a)({key:"shareDisplay",reducer:ct}),xt=Object(g.a)({key:"shareDisplay",saga:vt}),Pt=Object(b.compose)(Ft,xt,Tt)(Ct);n.d(t,"a",function(){return Vt});var qt=function(e){console.error("Dynamic page loading failed",e)},Ht=function(e){return function(t){e(null,t.default)}};function Vt(e){return[{path:"/share/dashboard",component:rt},{path:"/share/display",component:Pt},{path:"*",name:"notfound",getComponent:function(e,t){n.e(6).then(n.bind(null,"8937ca26cad1b574ef33")).then(Ht(t)).catch(qt)}}]}},2:function(e,t,n){n("5b15df55c1316f23e9d0"),e.exports=n("baf7021f8a6fabdc859e")},"295b38b8ebc92b4cd77f":function(e,t,n){"use strict";var r=n("ab4cb61bcb2dc161defb"),a=n("54f683fcda7806277002"),i=n("3ad3c1378076e862aab0"),o=n("74431d47afb6248fcb69"),c=n("4e2e9348dad8fe460c1d"),s=n("64609e458c41f180e307"),l=Object(a.fromJS)({locationBeforeTransitions:null});function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case i.LOCATION_CHANGE:return e.merge({locationBeforeTransitions:t.payload});default:return e}}n.d(t,"a",function(){return f});var d=Object(o.a)();function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=[d,Object(i.routerMiddleware)(t)],o=r.compose,l=Object(r.createStore)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.combineReducers)(Object.assign({route:u,language:s.a},e))}(),Object(a.fromJS)(e),o(r.applyMiddleware.apply(void 0,n)));return l.runSaga=d.run,l.injectedReducers={},l.injectedSagas={},l}},"6b84bc0ba52f69619b39":function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return i});var r=n("db3f152bc7e049b9271e");function a(e,t,n,a){return{type:r.b,payload:{username:e,password:t,shareInfo:n,resolve:a}}}function i(e){return{type:r.a,payload:{user:e}}}},baf7021f8a6fabdc859e:function(e,t,n){"use strict";n.r(t),function(e){n("8c8e4f08a118a28666b0"),n("8af190b70a6bc55c6f1b");var t,r=n("63f14ac74ce296f77f4d"),a=n("d7dd51e1bf6bfc2c9c3d"),i=n("657e23e47d6bc2372772"),o=n("3ad3c1378076e862aab0"),c=n("3e48a4ad164080264b3b"),s=n("66d806c6556aa1e94936"),l=n("be54f4964cb3d17da652"),u=n("3c6f77ec51e7bc1a2a2a"),d=n("8f1ab66ca98a22c9179d"),f=(n("1fa8f1fa59fdd9f24c28"),n("4ce54d943eb1f3decabb"),n("295b38b8ebc92b4cd77f")),b=n("ed636e9c6a0f78dd7081"),p=n("162badf8105dc7af2987"),g=(n("ed0aa665d8cc7f062de1"),n("1dad865dd74034286d56"),n("3670a75cdf40147fed09"),n("360199e61df61d70683e"),n("8a7df9b2a2fe5d99ea98"),n("c302bbd821e068aec7ca"),n("488186eb3b2e0c1c414a"),n("40f52d283acb8661d97f"),n("1a8a0d02691ba2237e1c"),n("c4f39450f01ceef3e1a4")),y=(n("9c18a49d5131280d62e2"),n("df7d0ca888dfc4ab84c0"),n("c75488ff72785c93e091"),n("9522c301b87f3097acdb"),n("c051faebbdca1b75abc0"),n("e7db2ab4d56937661155"),n("6350ba3c445cdf809f5d"),n("6d75da2315198816512d"),n("2e326f71ba041e9e5483"),n("32ed649d5a98409f05d0"),n("593fb6ed96492637817d"),n("0c83eda191a155223e4f"),n("70ed4cbab24ae23bde7d"),n("38209c7bc1e9aed95306"),n("9132142da73ea939e5d6"),n("ba53a5f89c617e663ad1"),n("8835a003a3ed67b22811"),n("8c6d270aa08c18b72e43"),n("0a240ff6093590e2060b"),n("61d2dc633a96c99ada22"),n("ed842d3aa93065270196"),n("4b78455cac8a29b25e34"),n("7e08bdc8c06aba9df8ea"),n("58a6adeccb3334926a24"),n("cf137f88cec7945b84a3"),n("d3c16768a7bfb407293b"),n("ec2bbc87777bad684f91"),n("545cc1d5b2c0ab4381ef"));function m(e,n,r,a){t||(t="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var i=e&&e.defaultProps,o=arguments.length-3;if(n||0===o||(n={children:void 0}),n&&i)for(var c in i)void 0===n[c]&&(n[c]=i[c]);else n||(n=i||{});if(1===o)n.children=a;else if(o>1){for(var s=new Array(o),l=0;l<o;l++)s[l]=arguments[l+3];n.children=s}return{$$typeof:t,type:e,key:void 0===r?null:""+r,ref:null,props:n,_owner:null}}g.registerTheme("default",y.n);var h=Object(f.a)({},i.d),v=document.getElementById("app"),O=Object(o.syncHistoryWithStore)(i.d,h,{selectLocationState:Object(u.a)()}),S={path:"/",component:Object(s.hot)(e)(l.a),childRoutes:Object(p.a)(h),indexRoute:{onEnter:function(e,t){t("/share")}}},I=function(e){r.render(m(a.Provider,{store:h},void 0,m(d.a,{messages:e},void 0,m(i.b,{history:O,routes:S,render:Object(i.c)(Object(c.useScroll)())}))),v)};window.Intl?I(b.b):new Promise(function(e){e(Promise.all([n.e(0),n.e(7)]).then(n.t.bind(null,"97694e21b72f8e9351c4",7)))}).then(function(){return Promise.all([n.e(0).then(n.t.bind(null,"f030ad8f70186ef5cb63",7))])}).then(function(){return I(b.b)}).catch(function(e){throw e}),window.__REACT_DEVTOOLS_GLOBAL_HOOK__&&(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.inject=function(){})}.call(this,n("044f282f6141fc605782")(e))},be54f4964cb3d17da652:function(e,t,n){"use strict";var r=n("8af190b70a6bc55c6f1b"),a=n("0d7f0986bcd2f33d8a2a"),i=n.n(a),o=n("ab4cb61bcb2dc161defb"),c=n("811a4999285c4f950f0a"),s=n("fe25efaa8d6f45e3f5f9"),l=n("db3f152bc7e049b9271e"),u=n("54f683fcda7806277002"),d=Object(u.fromJS)({logged:!1,loginUser:null});var f,b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case l.a:return e.set("logged",!0).set("loginUser",r.user);case l.c:return e.set("logged",!1).set("loginUser",null);default:return e}},p=n("74431d47afb6248fcb69"),g=n("6c68d13fe9e3e77d8fc4"),y=n("6b84bc0ba52f69619b39"),m=n("95066b9b78a83cfbe91a"),h=n("55c69f0ea731e712b8f3"),v=n("9adba983ceae6f089ff0"),O=regeneratorRuntime.mark(I),S=regeneratorRuntime.mark(w);function I(e){var t,n,r,a,i,o;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,n=t.username,r=t.password,a=t.shareInfo,i=t.resolve,c.prev=1,c.next=4,Object(g.b)(m.a,{method:"post",url:"".concat(v.a.share,"/login/").concat(a),data:{username:n,password:r}});case 4:return o=c.sent,c.next=7,Object(g.c)(Object(y.a)(o.payload));case 7:i(),c.next=13;break;case 10:c.prev=10,c.t0=c.catch(1),Object(h.a)(c.t0);case 13:case"end":return c.stop()}},O,this,[[1,10]])}function w(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(p.c)(l.b,I)];case 2:case"end":return e.stop()}},S,this)}function j(e,t,n,r){f||(f="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var a=e&&e.defaultProps,i=arguments.length-3;if(t||0===i||(t={children:void 0}),t&&a)for(var o in a)void 0===t[o]&&(t[o]=a[o]);else t||(t=a||{});if(1===i)t.children=r;else if(i>1){for(var c=new Array(i),s=0;s<i;s++)c[s]=arguments[s+3];t.children=c}return{$$typeof:f,type:e,key:void 0===n?null:""+n,ref:null,props:t,_owner:null}}var A=Object(c.a)({key:"global",reducer:b}),L=Object(s.a)({key:"global",saga:w});t.a=Object(o.compose)(A,L)(function(e){return j("div",{},void 0,j(i.a,{titleTemplate:"%s - Davinci",defaultTitle:"Davinci Web Application",meta:[{name:"description",content:"Davinci web application built for data visualization"}]}),r.Children.toArray(e.children))})},db3f152bc7e049b9271e:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a}),n.d(t,"c",function(){return i});var r="davinci/App/LOGIN",a="davinci/App/LOGGED",i="davinci/App/LOGOUT"}},[[2,10,0,5]]]);