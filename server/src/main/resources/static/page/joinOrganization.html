<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>激活</title>
</head>
<script src="/webjars/jquery/1.11.3/jquery.js"></script>
<script type="text/javascript">
    function getParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var authToken = '';


    function login() {
        var token = getParam("token");

        $.ajax({
            type: 'GET',
            url: "/hello/invate/" + token,
            async: false,
            dataType: 'json',
            success: function (data) {
                console.log(data)
                authToken = data.payload
            }
        })
    }


    function join() {
        var token = getParam("token");

        $.ajax({
            type: 'POST',
            url: "/api/v3/organizations/confirminvite/" + token,
            contentType: 'application/json',
            headers: {
                Authorization: 'Bearer ' + authToken,
            },
            async: false,
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data.header.code == 200) {
                    $('body').html("加入！！！")
                    alert("Success！！")
                } else if (data.header.code == 400) {
                    $('body').html(data.header.msg)
                    alert(data.header.msg)
                }
            }
        })
    }

</script>
<body>
<button type="button" onclick="login();" >登录</button>
    <br>
    <br>
<button type="button" onclick="join();">接受邀请</button>
</body>
</html>