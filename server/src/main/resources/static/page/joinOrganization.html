<!DOCTYPE html>
<!--
  ~ <<
  ~ Davinci
  ~ ==
  ~ Copyright (C) 2016 - 2018 EDP
  ~ ==
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~       http://www.apache.org/licenses/LICENSE-2.0
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  ~ >>
  -->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>激活</title>
</head>
<script src="/webjars/jquery/1.11.3/jquery.js"></script>
<script type="text/javascript">
    function getParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }

    var authToken = '';


    function login() {
        var token = getParam("token");

        $.ajax({
            type: 'GET',
            url: "/hello/invate/" + token,
            async: false,
            dataType: 'json',
            success: function (data) {
                console.log(data)
                authToken = data.payload
            }
        })
    }


    function join() {
        var token = getParam("token");

        $.ajax({
            type: 'POST',
            url: "/api/v3/organizations/confirminvite/" + token,
            contentType: 'application/json',
            headers: {
                Authorization: 'Bearer ' + authToken,
            },
            async: false,
            dataType: 'json',
            success: function (data) {
                console.log(data)
                if (data.header.code == 200) {
                    $('body').html("加入！！！")
                    alert("Success！！")
                } else if (data.header.code == 400) {
                    $('body').html(data.header.msg)
                    alert(data.header.msg)
                }
            }
        })
    }

</script>
<body>
<button type="button" onclick="login();" >登录</button>
    <br>
    <br>
<button type="button" onclick="join();">接受邀请</button>
</body>
</html>